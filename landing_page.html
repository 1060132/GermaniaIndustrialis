<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Germania Industrialis</title>
    <link rel="stylesheet" href="./landing_page.css" />
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <script src="https://unpkg.com/konva@9.3.6/konva.min.js"></script>
  </head>
  <body class="root">
    <audio id="soundFX">
      <source src="./Ding - Sound Effect (HD).mp3" type="audio/mpeg">
    </audio>
    <header>
      <h1 class="main-title">Germania Industrialis</h1>
      <div class="epoch-div">
        <ul>
          <li><a class="epoch-choser" href="./landing_page.html">1880</a></li>
          <li><a class="epoch-choser" href="./1895.html">1895</a></li>
          <li><a class="epoch-choser" href="./1910.html">1914</a></li>
        </ul>
      </div>
    </header>
    <div class="content">
      <div class="map-canvas">
        <canvas id="map" width="1400" height="850" class="map-img"></canvas>
      </div>
      <div class="sidebar">
        <img src="./8541853_home_icon (1).png" alt="Image 1" class="draggable" draggable="true" id="pic">
        <img src="./icons8-zeche-zollverein-80.png" alt="Image 2" class="draggable" draggable="true" id="pic">
        <img src="./icons8-mine-64.png" alt="Image 3" class="draggable" draggable="true" id="pic">
    
      </div>
      <div class="data">
        <div class="objects-first">
          <h1 class="title">Einwohner</h1>
          <div class="hl"></div>
          <img src="./309041_users_group_people_icon.png" class="factory" />
          <p class="count" id="count_inhabitants"></p>
        </div>
        <div class="objects-second">
          <h1 class="title">Gebäude</h1>
          <div class="hl"></div>
          <img src="./3671695_factory_icon.png" class="factory" />
          <ul class="factories">
            <li>
                <p id = housing></p>
            </li>
            <li>
                <p id="factories" ></p>
            </li>
            <li>
                <p id="farm"></p>
            </li>
            <li>
              <p id="zeche"></p>
            </li>
          </ul>
          <ul class="factories">
          </ul>
        </div>
        <div class="objects-third">
          <h1 class="title">Erze</h1>
          <div class="hl"></div>
          <img src="./icons8-stein-64.png" class="factory" />
          <ul class="factories">
            <li>
              <a id="coal-value"></a>
            </li>
            <li>
              <a id="steel-value"></a>
            </li>
          </ul>
        </div>
      </div>

      <div class="arbeitsbedingungen-window" id="popup-window">
        <img
          src="./Industrialisierung_1868-580.jpg"
          class="arbeitsbedingungen-foto"
        />
        <p class="working-conditions">
          Das Leben als Arbeiter in der Zeit der Industriellen Revolution war
          kein Zuckerschlecken, oft musste man sich als Kind für einen Beruf
          entscheiden, dieser war meist körperlich Anstrengend, und hat die
          Lebensqualität erheblich verschlechtert. Für einen Hungerlohn sind die
          Menschen bis zu 16 Stunden am Tag arbeiten gegangen. In der heutigen
          Zeit unvorstellbar!
        </p>
      </div>

      <div class="hohenzollern-window" id="hohenzollern">
        <p class="working-conditions">
          Das Haus Hohenzollern war eine der bedeutesten Dynastien der Deutschen
          Geschichte, auch in der Zeit der Hochindustrialisierung hatte sie
          großen Einfluss
        </p>
      </div>
      <div class="hohenzollern-window" id="arbeitsschutz">
        <p class="working-conditions">
          Verabschiedung des Arbeiterschutzgesetzes (1883):
          Das Arbeiterschutzgesetz von 1883 war ein Meilenstein in der deutschen Sozialgesetzgebung. Es legte Mindeststandards für Arbeitsbedingungen und Sicherheitsvorkehrungen fest und markierte einen bedeutenden Schritt hin zur Verbesserung der Arbeitsverhältnisse für Industriearbeiter.
        </p>
      </div>
      <div class="hohenzollern-window" id="DGB">
        <p class="working-conditions">
          Gründung des Deutschen Gewerkschaftsbunds (1886):
          Der Deutsche Gewerkschaftsbund (DGB) wurde als Dachverband für verschiedene Arbeitergewerkschaften gegründet. Er spielte eine wichtige Rolle bei der Organisation und Vertretung der Interessen der Arbeiterschaft während der Industrialisierung.
        </p>
      </div>
      <div class="hohenzollern-window" id="rueckversicherung">
        <p class="working-conditions">
          Bismarcks Rückversicherungsvertrag (1887):
Um das Deutsche Reich vor einer zweifrontigen Bedrohung zu schützen, schloss Otto von Bismarck einen geheimen Vertrag mit Russland. Dieser Vertrag sollte Deutschland eine gewisse Sicherheit gegenüber Frankreich verschaffen, indem es eine vorübergehende Allianz mit Russland einging.
        </p>
      </div>
      <div class="hohenzollern-window" id="krupp">
        <p class="working-conditions">
          Krupp-Stahlkonkurrenz (1889):
Die Krupp-Gruppe, ein führender deutscher Stahl- und Rüstungshersteller, erreichte in den späten 1880er Jahren einen Höhepunkt in der Produktion. Ihr technologischer Fortschritt und ihre Effizienz machten sie zu einem der größten und einflussreichsten Unternehmen Europas.
        </p>
      </div>
      <div class="wrapper">
        <div id="progress">
          <div id="bar">01.1880</div>
        </div>
      </div>
    </div>
  </body>
  <script>
    var startGame;
    var placeType;
    var i = 0;
    var housing_count = 0;
    const canvas = document.getElementById("map");
    var context = canvas.getContext("2d");
    var farm_count = 0;
    var factory_count = 0;
    var zeche_count = 0;
    var multiplier = 0;
    var background = new Image();
    background.src = "./Verlaufskarte_Ruhr2.png";
    var coalSum = 0;
    var ironSum = 0;
    var map_width = canvas.width / 9;
    var map_height = canvas.height / 15;
    const ctx = canvas.getContext("2d")
    let images  = [];

        let coalArray = [
      [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 80, 90, 0, 0, 70, 90, 70, 0],
      [0, 0, 0, 0, 50, 100, 100, 100, 100, 100, 95, 60, 0, 0],
      [0, 0, 0, 0, 60, 100, 100, 100, 50, 40, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 50, 50, 0, 0, 0, 0, 0, 0]
    ];
      let ironArray = [
      [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],
      [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],
      [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],
      [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],
      [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],
      [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],
      [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],
      [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]
      ];
    background.onload = function () {
      context.drawImage(background, 0, 0, canvas.width, canvas.height);
      function Sleep(milliseconds) {
        return new Promise((resolve) => setTimeout(resolve, milliseconds));
      }




      function placeObject(x, y, object) {
        var posX = x * map_width;
        var posY = y * map_height;

        var object_img = new Image();
        object_img.src = object;

        object_img.onload = function () {
          var object_width = 35;
          var object_height = 35;

          context.drawImage(
            object_img,
            posX,
            posY,
            object_width,
            object_height
          );
        };
      }

      async function showPopup(id, given_class) {
        var popup = document.getElementById(id);
        popup.classList.remove(given_class);
        popup.classList.toggle("show-popup");
        document.getElementById("soundFX").play()
        console.log(popup.classList);
        await Sleep(1800);
        popup.classList.remove("show-popup");
        popup.classList.toggle(given_class);
      }


      function move() {
        if (i == 0) {
          i = 1;
          var elem = document.getElementById("bar");
          var startDate = new Date(1880, 0, 1);
          var currentDate = new Date(startDate);
          var endDate = new Date(1891, 0, 1);

          elem.innerHTML = startDate.toLocaleDateString();

          var id = setInterval(frame, 600);

          function frame() {
            if (currentDate >= endDate) {
              clearInterval(id);
              i = 0;
            } else {
              currentDate.setMonth(currentDate.getMonth() + 1);
              var progressPercentage = Math.round(
                ((currentDate.getTime() - startDate.getTime()) /
                  (endDate.getTime() - startDate.getTime())) *
                  100
              );
              elem.style.width = progressPercentage + "%";
              elem.innerHTML = currentDate.toLocaleDateString();
              switch (currentDate.toLocaleDateString()) {
                case "1.2.1880":
                  showPopup("popup-window", "arbeitsbedingungen-window");
                  break;
                case "1.5.1880":
                    showPopup("hohenzollern" , "hohenzollern-window")
                    break;
                case "1.3.1883":
                  showPopup("arbeitsschutz", "hohenzollern-window")
                  break;
                case "1.3.1886":
                  showPopup("DGB", "hohenzollern-window")
                  break;
                case "1.3.1887": 
                  showPopup("rueckversicherung", "hohenzollern-window")
                  break;
                case "1.3.1889": 
                  showPopup("krupp", "hohenzollern-window")
                  break;
                  
              }
            }
          }
        }
      }

      function changeCoal(x_coordinate, y_coordinate) {
        document.getElementById("coal-value").innerHTML = zeche_count > 0 ? (zeche_count * 21000 + " t Kohle"): " ";
      }

      function changeIron() {
        document.getElementById("steel-value").innerHTML =  factory_count > 0 ? (factory_count * 2000 + " t Stahl"): " ";
      }


      function changeInhabitants() {
        console.log(housing_count)
        document.getElementById("count_inhabitants").innerHTML = 
        (housing_count == 0 ? " ": housing_count* 15000 + " Einwohner ");
      }

      fetch("./first-page.json")
        .then((response) => response.json())
        .then((data) => {
          let buildingNames = Object.keys(data);

          let buildingCount = buildingNames.length;
          if (buildingCount == 0) {;
          } else {
            move();
          }

          for (let i = 0; i < buildingCount; i++) {
            let currentBuildingName = buildingNames[i];
            let building = data[currentBuildingName];

            let buildingType = building["type"];

            switch (buildingType) {
              case "Haus":
                placeType = "./icons8-zuhause-50.png";
                document.getElementById("count_inhabitants").innerHTML = (data.counter.Haeuser == 0 ? " ": data.counter.Haeuser* 15000 + " Einwohner ");
                
                break;
              case "Fabrik":
                factory_count = data.counter.Fabrik
                ironSum += 
                placeType = "./3671695_factory_icon.png";
                document.getElementById("steel-value").innerHTML = (data.counter.Fabriken == 0 ? " ": data.counter.Fabriken * ironArray[building["x-Coordinate"]][building["y-Coordinate"]]  + " t Eisen")
                document.getElementById("factories").innerHTML = factory_count == 1 ? (factory_count + " Firma") : (factory_count > 0 ? (factory_count + " Firmen"): "")
                break;
              case "Farm":
                placeType = "./icons8-bauernhof-100.png";
                document.getElementById("farm").innerHTML = data.counter.Farm == 1 ? (data.counter.Farm + " Bauernhof") : (data.counter.Farm > 0 ? (data.counter.Farm + " Bauernhöfe"): "")
                break;
              case "Zeche":
                console.log(coalArray[building["x-Coordinate"]][building["y-Coordinate"]])
                coalSum += 1000 * (coalArray[building["x-Coordinate"]][building["y-Coordinate"]] / 100)
                placeType = "./icons8-zeche-zollverein-80.png";
                document.getElementById("coal-value").innerHTML = data.counter.Zechen > 0 ? (coalSum + " t Kohle"): " ";
                document.getElementById("zeche").innerHTML = data.counter.Zechen == 1 ? (data.counter.Zechen + "Zeche"): (data.counter.Zechen > 0 ? (data.counter.Zechen +  " Zechen"): " ");
                break;
            }

            placeObject(
              building["x-Coordinate"],
              building["y-Coordinate"],
              placeType
            );
            
          }
        }
        );

      window.addEventListener("DOMContentLoaded", (event) => {
        var canvas = document.getElementById("map");
        var context = canvas.getContext("2d");

        function setCanvasSize() {
          var container = canvas.parentNode;
          canvas.width = container.offsetWidth;
          canvas.height = container.offsetHeight;
        }
        setCanvasSize();

        window.addEventListener("resize", setCanvasSize);
      });
    };
  </script>
</html>